@model IEnumerable<Vidly.Models.Customer>
@{
    ViewBag.Title = "Customers";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<h2>Customers</h2>
<div>
    @Html.ActionLink("Add Customer", "New", "Customers", new { area = "" }, new { @class = "btn btn-primary" })
    <p></p>
</div>
@if (Model.Any())
{
    <div>
        <table id="customers" class="table table-bordered table-hover">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Discount rate</th>
                    <th>Delete</th>
                </tr>
            </thead>
            <tbody>
               @foreach (var customer in Model)
                {
                    <tr>
                        <td>@Html.ActionLink(customer.Name, "Edit", "Customers", new { id = customer.Id }, null)</td>
                        <td>@customer.MembershipType.Name</td>
                        <td><button data-customer-id="@customer.Id" class="btn-link js-delete">Delete</button></td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
}
else
{
    <h4>There are no customers to show</h4>
}

@section scripts
{
    <script>
        //$(function () {
        //    $("#customers").DataTable({
        //        ajax: {
        //            url: "api/customers",
        //            dataSrc: ""
        //        },
        //        columns: [
        //            {
        //                data: "name",
        //                render: (data, type, customer) => "<a href='/customers/edit/" + customer.id + "'>" + customer.name + "</a>"
        //            },
        //            {
        //                data: "name"
        //            },
        //            {
        //                data: "id",
        //                render: data => "<button class='btn-link delete-js> data-customer-id='" + data + "'>Delete</button>" 
        //            }
        //        ]
        //    });

            $("#customers").on("click", ".js-delete", function () {
                bootbox.confirm("Are You sure You want to delete this customer?", result => {
                    if (result) {
                        $.ajax({
                            url: "/api/customers/" + $(this).attr("data-customer-id"),
                            method: "DELETE",
                            success: () => {
                                $(this).parents("tr").remove();
                            }
                        });
                    }
                });
            })
        });
    </script>
}